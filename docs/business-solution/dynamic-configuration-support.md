# 动态业务配置支持

之前碰到一个业务的动态配置实现有两种方式，但是感觉都有瑕疵：

+ 本地缓存 + MySQL

  实现方式：服务实例中设置定时任务每隔几分钟从MySQL同步一下，同步到本地缓存。

  存在问题：

  + 本地配置无法实时更新
  + 配置其实修改频率很低，每隔几分钟同步一次，浪费系统资源。

+ Redis

  实现方式：直接将配置存在Redis。

  存在问题：

  + 配置其实修改频率很低，每次都通过请求Redis服务器拉取配置，浪费系统资源。

其实可以通过 Zookeeper、Nacos、Apollo、Disconf 这些成熟的中间件作为业务配置中心。
针对配置修改频率低的特点，使用配置中心**主动推送**的模式明显更合理。

这里以活动为例展示分别使用 Zookeeper、Nacos 实现业务配置中心。

为简单起见配置数据仅包含活动开始和结束时间。



## Zookeeper 作为业务配置中心

核心原理就是使用持久化节点保存配置数据，ZK客户端（业务服务）注册监控（Watcher）监听节点数据变化，一旦有数据变更则更新本地数据。

> 注意数据是 ZK Server 主动推过来的。



## Nacos 作为业务配置中心

本质和上面的原理类似，依赖 Nacos 注册与发现，Nacos 配置变更后可以通过监听客户端列表以主动推的方式发给各个服务实例。


